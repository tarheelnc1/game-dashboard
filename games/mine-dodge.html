<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mine Dodge - Progressive Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
            color: #555;
        }

        .stat-icon {
            font-size: 1.3em;
        }

        .stat-text strong {
            color: #667eea;
            font-weight: bold;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .timer {
            color: #ff4757;
        }

        .timer.warning {
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .level-info {
            font-size: 1.3em;
            margin-bottom: 20px;
            color: #333;
        }

        .boxes-container {
            display: grid;
            gap: 15px;
            margin: 30px auto;
            max-width: 500px;
            min-height: 200px;
            align-items: center;
            justify-content: center;
        }

        .box {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        .box:hover:not(.revealed) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .box.revealed {
            cursor: default;
            animation: flipBox 0.5s ease-out;
            pointer-events: none;
        }

        .box.safe {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .box.mine {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        @keyframes flipBox {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }

        .box-content {
            display: none;
        }

        .box.revealed .box-content {
            display: block;
        }

        .message {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success {
            color: #2ecc71;
        }

        .danger {
            color: #e74c3c;
        }

        .info {
            color: #667eea;
        }

        .start-btn, .next-btn, .restart-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .start-btn:hover, .next-btn:hover, .restart-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .next-btn {
            background: #2ecc71;
        }

        .next-btn:hover {
            background: #27ae60;
        }

        .restart-btn {
            background: #e74c3c;
        }

        .restart-btn:hover {
            background: #c0392b;
        }

        .reset-stats-btn {
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: bold;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .reset-stats-btn:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .final-stats {
            background: #d4edda;
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .final-stats h2 {
            color: #2ecc71;
            margin-bottom: 15px;
        }

        .stat-line {
            font-size: 1.3em;
            margin: 10px 0;
            color: #333;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .stats-bar {
                gap: 5px;
                padding: 10px;
            }

            .stat-item {
                font-size: 0.85em;
                gap: 5px;
            }

            .stat-icon {
                font-size: 1.1em;
            }

            .box {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ’£ Mine Dodge</h1>
        <p class="subtitle">Avoid the mines and beat all levels!</p>

        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-icon">ğŸ®</span>
                <span class="stat-text">Played: <strong id="gamesPlayed">0</strong></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ†</span>
                <span class="stat-text">Won: <strong id="gamesWon">0</strong></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ“Š</span>
                <span class="stat-text">Win Rate: <strong id="winRate">0%</strong></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">â­</span>
                <span class="stat-text">Best: <strong id="bestScore">0</strong></span>
            </div>
        </div>

        <div class="game-info">
            <div class="info-item">
                <div class="info-label">Level</div>
                <div class="info-value" id="levelDisplay">1</div>
            </div>
            <div class="info-item">
                <div class="info-label">Time Left</div>
                <div class="info-value timer" id="timerDisplay">5</div>
            </div>
            <div class="info-item">
                <div class="info-label">Bonus Time</div>
                <div class="info-value" id="bonusDisplay">0</div>
            </div>
        </div>

        <div class="level-info" id="levelInfo">
            Click START to begin!
        </div>

        <div class="boxes-container" id="boxesContainer"></div>

        <div class="message" id="message"></div>

        <div id="controls">
            <button class="start-btn" id="startBtn" onclick="startGame()">START GAME</button>
            <button class="next-btn hidden" id="nextBtn" onclick="nextLevel()">NEXT LEVEL â¡ï¸</button>
            <button class="restart-btn hidden" id="restartBtn" onclick="restartGame()">PLAY AGAIN</button>
        </div>

        <button class="reset-stats-btn" onclick="resetStats()">ğŸ”„ Reset Stats</button>

        <div class="final-stats hidden" id="finalStats"></div>
    </div>

    <script>
        // Game Configuration (easy to modify)
        const LEVEL_CONFIG = [
            { level: 1, boxes: 2, mines: 1, baseTime: 5, selectionsNeeded: 1 },
            { level: 2, boxes: 4, mines: 1, baseTime: 5, selectionsNeeded: 2 },
            { level: 3, boxes: 6, mines: 1, baseTime: 5, selectionsNeeded: 3 },
            { level: 4, boxes: 8, mines: 1, baseTime: 5, selectionsNeeded: 4 }
        ];

        // Game State
        let currentLevel = 0;
        let timeLeft = 0;
        let bonusTime = 0;
        let timerInterval = null;
        let minePositions = [];
        let gameActive = false;
        let totalTime = 0;
        let selectionsNeeded = 0;
        let selectionsMade = 0;
        let selectedBoxes = [];

        // Statistics
        let stats = {
            gamesPlayed: 0,
            gamesWon: 0,
            bestScore: 0
        };

        // Load statistics from localStorage
        function loadStats() {
            const saved = localStorage.getItem('mineDodgeStats');
            if (saved) {
                stats = JSON.parse(saved);
            }
            updateStatsDisplay();
        }

        // Save statistics to localStorage
        function saveStats() {
            localStorage.setItem('mineDodgeStats', JSON.stringify(stats));
            updateStatsDisplay();
        }

        // Update statistics display
        function updateStatsDisplay() {
            document.getElementById('gamesPlayed').textContent = stats.gamesPlayed;
            document.getElementById('gamesWon').textContent = stats.gamesWon;
            
            const winRate = stats.gamesPlayed > 0 
                ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) 
                : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            
            document.getElementById('bestScore').textContent = stats.bestScore;
        }

        // Update statistics when game ends
        function updateStats(won, score) {
            stats.gamesPlayed++;
            if (won) {
                stats.gamesWon++;
            }
            if (score > stats.bestScore) {
                stats.bestScore = score;
            }
            saveStats();
        }

        // Reset statistics
        function resetStats() {
            if (confirm('Are you sure you want to reset all statistics?')) {
                stats = {
                    gamesPlayed: 0,
                    gamesWon: 0,
                    bestScore: 0
                };
                saveStats();
                alert('Statistics have been reset!');
            }
        }

        // Initialize game on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
        });

        function startGame() {
            currentLevel = 0;
            bonusTime = 0;
            totalTime = 0;
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('finalStats').classList.add('hidden');
            loadLevel();
        }

        function loadLevel() {
            const config = LEVEL_CONFIG[currentLevel];
            
            // Clear previous level
            clearInterval(timerInterval);
            document.getElementById('boxesContainer').innerHTML = '';
            document.getElementById('message').textContent = '';
            
            // Reset selections
            selectionsNeeded = config.selectionsNeeded;
            selectionsMade = 0;
            selectedBoxes = [];
            
            // Update display
            document.getElementById('levelDisplay').textContent = config.level;
            document.getElementById('bonusDisplay').textContent = bonusTime;
            
            // Update level info with selections needed
            let infoText = `Level ${config.level}: Choose ${config.selectionsNeeded} safe box${config.selectionsNeeded > 1 ? 'es' : ''}!<br>`;
            infoText += `<span style="color: #666; font-size: 0.9em;">`;
            infoText += `${config.boxes} boxes, ${config.mines} mine${config.mines > 1 ? 's' : ''} | `;
            infoText += `Selected: <span id="selectCount" style="color: #667eea; font-weight: bold;">0/${config.selectionsNeeded}</span>`;
            infoText += `</span>`;
            
            document.getElementById('levelInfo').innerHTML = infoText;
            
            // Set up time (base time + bonus from previous level)
            timeLeft = config.baseTime + bonusTime;
            document.getElementById('timerDisplay').textContent = timeLeft;
            
            // Generate boxes
            generateBoxes(config.boxes, config.mines);
            
            // Start timer
            gameActive = true;
            startTimer();
        }

        function generateBoxes(numBoxes, numMines) {
            const container = document.getElementById('boxesContainer');
            
            // Set grid columns based on number of boxes
            let columns = 2;
            if (numBoxes === 4) columns = 2;
            else if (numBoxes === 6) columns = 3;
            else if (numBoxes === 8) columns = 4;
            
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            
            // Randomly place mines
            minePositions = [];
            while (minePositions.length < numMines) {
                const pos = Math.floor(Math.random() * numBoxes);
                if (!minePositions.includes(pos)) {
                    minePositions.push(pos);
                }
            }
            
            // Create boxes
            for (let i = 0; i < numBoxes; i++) {
                const box = document.createElement('div');
                box.className = 'box';
                box.dataset.index = i;
                box.innerHTML = '<div class="box-content"></div>';
                box.onclick = () => selectBox(i);
                container.appendChild(box);
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timerDisplay').textContent = timeLeft;
                
                // Warning animation when time is low
                const timerEl = document.getElementById('timerDisplay');
                if (timeLeft <= 2) {
                    timerEl.classList.add('warning');
                } else {
                    timerEl.classList.remove('warning');
                }
                
                // Time's up!
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    gameOver(false);
                }
            }, 1000);
        }

        function selectBox(index) {
            if (!gameActive) return;
            if (selectedBoxes.includes(index)) return; // Already selected
            
            const boxes = document.querySelectorAll('.box');
            const selectedBox = boxes[index];
            
            // Reveal selected box
            setTimeout(() => {
                if (minePositions.includes(index)) {
                    // Hit a mine!
                    gameActive = false;
                    clearInterval(timerInterval);
                    selectedBox.classList.add('revealed', 'mine');
                    selectedBox.querySelector('.box-content').textContent = 'ğŸ’£';
                    gameOver(false);
                } else {
                    // Safe!
                    selectedBox.classList.add('revealed', 'safe');
                    selectedBox.querySelector('.box-content').textContent = 'âœ…';
                    selectedBoxes.push(index);
                    selectionsMade++;
                    
                    // Update selection count
                    const selectCount = document.getElementById('selectCount');
                    if (selectCount) {
                        selectCount.textContent = `${selectionsMade}/${selectionsNeeded}`;
                    }
                    
                    // Check if level is complete
                    if (selectionsMade >= selectionsNeeded) {
                        gameActive = false;
                        clearInterval(timerInterval);
                        levelComplete();
                    } else {
                        // Show progress message
                        const message = document.getElementById('message');
                        message.textContent = `âœ… Safe! Select ${selectionsNeeded - selectionsMade} more!`;
                        message.className = 'message info';
                    }
                }
            }, 100);
        }

        function levelComplete() {
            const message = document.getElementById('message');
            message.textContent = `âœ… Level ${currentLevel + 1} Complete!`;
            message.className = 'message success';
            
            // Add remaining time to bonus
            bonusTime += timeLeft;
            totalTime += timeLeft;
            document.getElementById('bonusDisplay').textContent = bonusTime;
            
            // Check if game is complete
            if (currentLevel >= LEVEL_CONFIG.length - 1) {
                // Won all levels!
                setTimeout(() => {
                    gameWon();
                }, 1500);
            } else {
                // Show next level button
                document.getElementById('nextBtn').classList.remove('hidden');
            }
        }

        function nextLevel() {
            document.getElementById('nextBtn').classList.add('hidden');
            currentLevel++;
            loadLevel();
        }

        function gameOver(won) {
            gameActive = false;
            clearInterval(timerInterval);
            
            if (!won) {
                const message = document.getElementById('message');
                message.textContent = 'ğŸ’¥ BOOM! You hit a mine!';
                message.className = 'message danger';
                
                // Reveal all boxes
                const boxes = document.querySelectorAll('.box');
                boxes.forEach((box, index) => {
                    setTimeout(() => {
                        box.classList.add('revealed');
                        if (minePositions.includes(index)) {
                            box.classList.add('mine');
                            box.querySelector('.box-content').textContent = 'ğŸ’£';
                        } else {
                            box.classList.add('safe');
                            box.querySelector('.box-content').textContent = 'âœ…';
                        }
                    }, index * 100);
                });
                
                // Show restart button
                setTimeout(() => {
                    document.getElementById('restartBtn').classList.remove('hidden');
                }, boxes.length * 100 + 500);
                
                // Report score and update stats
                const score = calculateScore(currentLevel + 1, false);
                updateStats(false, score);  // â† Track game played (lost)
                reportScore(score);
            }
        }

        function gameWon() {
            const score = calculateScore(LEVEL_CONFIG.length, true);
            
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML = `
                <h2>ğŸ‰ YOU WON!</h2>
                <div class="stat-line">âœ… All ${LEVEL_CONFIG.length} levels completed!</div>
                <div class="stat-line">â±ï¸ Total bonus time: ${totalTime}s</div>
                <div class="stat-line">ğŸ† Final Score: ${score}</div>
                <div class="stat-line" style="color: #667eea; margin-top: 15px;">
                    ${score > stats.bestScore ? 'â­ NEW BEST SCORE!' : ''}
                </div>
            `;
            finalStats.classList.remove('hidden');
            
            document.getElementById('message').textContent = '';
            document.getElementById('restartBtn').classList.remove('hidden');
            
            // Report score and update stats
            updateStats(true, score);  // â† Track game played (won)
            reportScore(score);
        }

        function restartGame() {
            document.getElementById('restartBtn').classList.add('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('finalStats').classList.add('hidden');
            currentLevel = 0;
            bonusTime = 0;
            totalTime = 0;
            loadLevel();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Calculate score based on performance
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function calculateScore(levelsCompleted, won) {
            // Base score: levels completed Ã— 25
            let score = levelsCompleted * 25;
            
            // Completion bonus
            if (won) {
                score += 100;
            }
            
            // Time bonus (total bonus time Ã— 5)
            score += totalTime * 5;
            
            return score;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Report score to dashboard
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function reportScore(finalScore) {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'GAME_SCORE',
                    gameId: 'mine-dodge',  // Must match GAME_LIBRARY id
                    score: finalScore
                }, '*');
                console.log('âœ… Score reported:', finalScore);
            }
        }
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    </script>
</body>
</html>
